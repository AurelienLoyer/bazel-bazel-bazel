:revealjsdir: https://cdn.rawgit.com/hakimel/reveal.js/3.8.0/
:revnumber: {project-version}
:example-caption!:
ifndef::imagesdir[:imagesdir: images]
:docinfo: shared
:navigation:
:menu:
:header_footer: true
:status:
:slideNumber: true
:showSlideNumber: true
:title-slide-transition: zoom
:title-slide-transition-speed: fast
:icons: font
:revealjs_history: true

[.black.background]
== !

[.notes]
--
Aurelien

Nous sommes √† une epoque ou la taille de nos projet est de plus en grande, le nombre de dependances grossit de jour en jour, ou encore la duree d'un build et de nots tests sont trop long pour avoir un feedback rapidement. parler de lInner source . ous ne sommes pas les seuls a avoir ce probl√®me. En effet, des grosses soci√©tes se sont pench√©s sur le sujet, et notamment Google qui propose ... 
--

== !

image::bazel.png[]

[.notes]
--
Aurelien
l'outil open-source Bazel que nous allons vous pr√©senter aujourd'hui
--

[.speaker]
== !

[id="speaker-bio"]
--
Emmanuel DEMEY

Developer Advocate √† Zenika Lille 

@EmmanuelDemey
--

image::emmanuel.jpg[]

[.speaker]
== !

[id="speaker-bio"]
--
Aur√©lien LOYER

Consultant √† Zenika Lille 

@AurelienDemey
--

image::aurelien.jpeg[]

include::chapters/chezgoogle.adoc[]

include::chapters/function-pure.adoc[]

include::chapters/angular.adoc[]

== !

NOTE: Il faut voir Bazel comme un orchestrateur, et non comme un nouvel outil de build √† apprendre

[.notes]
--
--

== üá´üá∑ Multi Langage

[.column]
* Android
* C / C++
* C#
* Docker
* Go
* Groovy

[.column]
* Kotlin
* iOS
* Java
* Javascript
* Perl
* Rust

[.column]
* Python
* Ruby
* Rust
* Sass
* Typescript
* ...

[.notes]
--
Parler d'extensibilite. 
faut indiquer que certains des languages sont support√©s par d√©faut. 
--

== Getting Started

++++
<iframe src="https://giphy.com/embed/1BFGiiHYS2dAbC0Lx1" width="480" height="480" frameBorder="0" class="giphy-embed" allowFullScreen></iframe>
++++

[.notes]
--
TODO: 
- Parler de la granularit√© a utiliser. comme mave ? ou une granulatie plus petite. on gagne en performance, mais on perd en maintenabilite
--

== Starlark

[source,python]
----
def fizz_buzz(n):
  """Print Fizz Buzz numbers from 1 to n."""
  for i in range(1, n + 1):
    s = ""
    if i % 3 == 0:
      s += "Fizz"
    if i % 5 == 0:
      s += "Buzz"
    print(s if s else i)

fizz_buzz(20)
----

[.notes]
--
--

== Diff√©rence avec Python

[%step]
* Les variables globales sont immutables
* Les `for` et `if` utilisables que dans des fonctions
* Recursion impossible
* Modifier une collection pendant une it√©ration
* Les `class` et `import` non support√©s (`struct` et `load`).
* Les `string` sont entre double quotes
* ...


[.notes]
--
TODO: 
- Mettre le contenu d'un fichier bzl. Pour montrer que c'est tres complique et que nous allons preferer utiliser des rules predefinies
--

[.hidden-title]
== Diff√©rence avec Python

[.fullscreen]
[source,python]
include::starlark[]
----
[.list-without-style.hidden-title.two-em]
== Terminologie

[%step]
* Workspace
* Package

[.notes]
--
--


[.hidden-title]
== Getting Started

image::structure.png[structure,600,600]

[.list-without-style.hidden-title.two-em]
== Terminologie

[%step]
* Rule
* Target

[.notes]
--
--

== Utiliser une rule

[source,python]
----
genrule(
    srcs = [ ... ],
    outs = [ ... ],
    cmd = " ... ",
)
----

[.notes]
--
TODO: 
- appeler gen_rule
--

== Cr√©er une target

[source,python]
----
genrule(
    name = "copy-file",
    srcs = [ ... ],
    outs = [ ... ],
    cmd = " ... ",
)
----

[.notes]
--
TODO: 
- appeler gen_rule
--

== Les labels

Un label correspond √† 

* un fichier 
* une target

=== Les labels

* //foo/bar:wiz	
* //foo/bar
* //foo/bar:all
* //foo/...

[.notes]
--
--

=== Les labels

Si je suis dans le r√©pertoire `foo`

* :foo == //foo:foo.
* bar:wiz == //foo/bar:wiz.
* bar/wiz == //foo/bar/wiz:wiz.

[.notes]
--
--

== Cr√©er une target

[source,python]
---- 
// //nestjs/BUILD.bazel
genrule(
    name = "copy-file",
    srcs = [
        "//angular:README.md",
    ],
    outs = ["README-nestjs.md"],
    cmd = "cp $< $@",
)
----

== D√©pendances

[source,python]
----
genrule(
    name = "copy-file",
    srcs = [
        "//angular:README.md",
    ],
    outs = ["README-nestjs.md"],
    cmd = "cp $< $@",
)

genrule(
    name = "concat",
    srcs = [
        "copy-file", "//:LICENCE",
    ],
    outs = ["final.txt"],
    cmd = "cat $(locations //copy-file) $(location //some:file2) > $@",
)
----

[.notes]
--
TODO: 
- appeler gen_rule apres une autre genrule pour montrer la dependances
--

== Macro

[source,python]
----
// //:rules.bzl
def my_macro(name, **kwargs):
    genrule(
        name = "%s_first" % name,
        srcs = [
            "//angular:README.md",
        ],
        outs = ["README-nestjs.md"],
        cmd = "cp $< $@",
    )

    genrule(
        name = name,
        **kwargs
    )
----

== Macro

[source,python]
----
load("//:rules.bzl", "my_macro")

my_macro(
    name = "concat",
    srcs = [
        "copy-file", "//:LICENCE",
    ],
    outs = ["final.txt"],
    cmd = "cat $(locations //copy-file) $(location //some:file2) > $@"
)
----

== Custom rules

[source,python]
----
def ts_binary_impl(ctx):
  files = list(get_transitive_files(ctx))
  output = ctx.outputs.out
  flags = ' '.join(ctx.attr.flags)
  ctx.action(
      inputs=files,
      outputs=[output],
      command="tsc %s --out %s %s" % (
          flags, output.path, ' '.join([f.path for f in files])))

ts_binary = rule(
  implementation = ts_binary_impl,
  attrs = {
      "srcs": attr.label_list(allow_files=ts_filetype),
      "deps": attr.label_list(allow_files=False),
      "flags": attr.string_list(),
  },
  outputs = {"out": "%{name}.js"},
)]
----

[.notes]
--
--

== !

++++
<iframe src="https://giphy.com/embed/uhb1F8ebDgkzC" width="960" height="540" frameBorder="0" class="giphy-embed" allowFullScreen></iframe>
++++

[.notes]
--
TODO:
Manu
- /Users/emmanueldemey/Documents/workspaces/oss/rules_nodejs/packages/labs/src/protobufjs/ts_proto_library.bzls
- Parler que nous pouvons d√©finir des variabls priv√©es
- Parler de l'outillage
    - Parler du beautifuer
    - Parler des extensions VSCode
revenir sur le code angulkar pour expliquer les fichiers build genere
https://dev.to/jakeherringbone/layering-in-bazel-for-web-389h
presentation de ibazel

DEmo angular d'aurelien

Demo rule node Manu
--

[.hidden-title]
== Conclusion

image::release.png[release,600,600]

[.notes]
--
Manu
TODO: 
- Ajouter un diff GIT pour montrer les fichiers ajout√©s
- Support dans Angular CLI 
- Builder en remote avec plus core 
Ce n'est pas pour tout le monde
Pour un startup ou un nouveau projet, ne pas choisir bazel
Choisir une solution historique. si le projet grossit, eventuellement .

Ecosysteme plus large
Syntaxe a simplifier 
Documentation
Creer de l'outillage pour faciliter la migraton. Un plugin existe deja pour migrer maven, et gazelle pour le monde nodejs
Regarder le projet angular. extraire le fichier BUILD
--

== Pour aller plus loin 

- https://www.youtube.com/watch?v=2UOFm-Cc_cU[Migration Maven / Gradle vers Bazel]